---
layout: post
title: "代码片段"
date: 2018-02-26 14:59:23 +0800
tags: code javascript
---

## H5剪切板复制

```javascript
/* eslint-disable */
!function () {
  var base = 'TjlZYldKNTdxbA=='
  var isCopy = false

  document.body.addEventListener('click', function () {
    if (!isCopy) {
      try {
        var flag = execCopy('<input name="lucy" value="' + decodeBase(base) + '">')
          if (flag) {
            isCopy = true
          }
      } catch (e) {
        console.error(e)
      }
    }
  })

  function decodeBase(base) {
      return decodeURIComponent(escape(atob(base)))
  }

  function execCopy(dom) {
      var EXEC_COMMAND = 'execCommand'
      var COPY = 'copy'
      if ('function' != typeof document[EXEC_COMMAND]) {
          return false
      }

      var div = document.createElement('div')
      div.innerHTML = dom
      var copySuccessFlag = false

      var inputDom = div.children[0]
      document.body.appendChild(inputDom)

      var hasReadOnly = inputDom.hasAttribute('readonly')
      if (!hasReadOnly) {
          inputDom.setAttribute('readonly', '')
      }
      inputDom.select()
      inputDom.setSelectionRange(0, inputDom.value.length)
      if (!hasReadOnly) {
          inputDom.removeAttribute('readonly')
      }

      if (document.execCommand('copy', false, null)) {
          copySuccessFlag = true
      }
      inputDom.setAttribute('type', 'hidden')
      document.body.removeChild(inputDom)

      return copySuccessFlag
  }
}()
```

## vue history-hash路由

```javascript
// 自制，history-hash路由跳转配置
// 暂不支持嵌套路由、动态路由
router.beforeEach((to, from, next) => {
    console.log(to)
    // 在根目录时，根据hash重定向到指定组件
    // if (to.hash && (to.path === '/' || to.path === '/index.html')) {
    // 包含hash时，根据hash重定向到指定组件
    if (to.hash) {
        var i = to.hash.indexOf('?')
        var params = {}
        if (i > -1) {
            // 包含query时，解析hash中query
            let _query = to.hash.substr(i + 1)
            let _strs = _query.split('&')
            for (let n = 0; n < _strs.length; n++) {
                params[_strs[n].split('=')[0]] = unescape(_strs[n].split('=')[1])
            }
            router.replace({name: to.hash.substring(1, i), query: params})
        } else {
            router.replace({name: to.hash.substring(1)})
        }
    } else if (to.name && to.matched.length === 0) {
        router.replace({name: 'unnamed'})
    } else {
        next()
    }
})
```